@using H5pPlayer.BusinessLogic.Entities
@using H5pPlayer.BusinessLogic.UseCases.TerminateH5pPlayer
@using H5pPlayer.Presentation.View
@using Microsoft.Extensions.Logging
@using MudBlazor



<!-- Attention: 
    Why PlayerH5p.razor not H5pPlayer.razor:
    the Razor file must never have the same name as the Dll, i.e. never: dll-name.razor
    see: https://www.reddit.com/r/Blazor/comments/iuumr2/avoid_my_idiocy/
    see only intern: https://wiki.projekt-adler.eu/de/AMG/Blazor/Naming
-->

<H5pPlayerView 
    H5pZipSourcePath="@H5pZipSourcePath"
    UnzippedH5psPath="@UnzippedH5psPath"
    DisplayMode="@DisplayMode"
    OnPlayerFinished="HandleFinish">
</H5pPlayerView>

@code {

    [CascadingParameter] 
    IMudDialogInstance? MudDialog { get; set; }
    
    [Parameter] 
    public string? H5pZipSourcePath { get; set; }

    [Parameter] 
    public string? UnzippedH5psPath{ get; set; }
    
    [Parameter]
    public H5pDisplayMode DisplayMode { get; set; }
    
    [Parameter]
    public Action<H5pPlayerResultTO>? OnPlayerFinished { get; set; }
   
    [Parameter]
    public ILogger? Logger { get; set; }

    private void HandleFinish(H5pPlayerResultTO result)
    {
        Logger?.LogInformation("PlayerH5p HandleFinished called");
        // Callback weitergeben
        OnPlayerFinished?.Invoke(result);

        // Dialog schließen und Ergebnis zurückgeben
        MudDialog?.Close(DialogResult.Ok(result));
    }
}
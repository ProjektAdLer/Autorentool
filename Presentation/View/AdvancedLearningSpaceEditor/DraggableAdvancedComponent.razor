@using Presentation.Components
@using Presentation.Components.RightClickMenu
@using Presentation.PresentationLogic.SelectedViewModels
@using Microsoft.AspNetCore.Components
@using Presentation.PresentationLogic.AdvancedLearningSpaceEditor
@using Presentation.PresentationLogic.AdvancedLearningSpaceEditor.AdvancedComponent
@using Presentation.PresentationLogic.AdvancedLearningSpaceEditor.AdvancedLearningSpaceEditor

<Draggable LearningObject="AdvancedComponent" OnClicked="@OnClickedDraggable" OnDoubleClicked="@OnDoubleClickedDraggable"
           OnRightClicked="@OnRightClickedDraggable" OnDragged="@OnDraggedDraggable"
           @bind-X="@AdvancedComponent.PositionX" @bind-Y="@AdvancedComponent.PositionY">

    @* Wird mit Code Ã¼berschrieben *@
    @((MarkupString)String.Format(ObjectShape, ObjectStyle, ObjectName))
    <Clickable OnClickedParam="AdvancedComponent" OnClicked="@OnClickedDeleteObject">
        @((MarkupString)DeleteObjectButtonShape)
    </Clickable>
</Draggable>


@ChildContent

@code {
    [Parameter]
    public RenderFragment? ChildContent { get; set; }
    
    // // Overwrite nullability warning below because we check in OnParametersSet
    [Parameter, EditorRequired]
    public IAdvancedComponentViewModel AdvancedComponent { get; set; } = null!;
    [Parameter, EditorRequired]
    public EventCallback<IAdvancedComponentViewModel> OnClickedDraggable { get; set; }
    [Parameter]
    public EventCallback<IAdvancedComponentViewModel> OnDoubleClickedDraggable { get; set; }
    [Parameter, EditorRequired]
    public EventCallback<IAdvancedComponentViewModel> OnRightClickedDraggable { get; set; }
    [Parameter, EditorRequired]
    public DraggedEventArgs<IAdvancedComponentViewModel>.DraggedEventHandler? OnDraggedDraggable { get; set; }
    [Parameter, EditorRequired]
    public EventCallback<IAdvancedComponentViewModel> OnClickedDeleteObject { get; set; }
    // Overwrite nullability warning below because service may never be null
    [Parameter, EditorRequired]
    public IAdvancedLearningSpaceEditorPresenter AdvancedEditorPresenter { get; set; } = null!;
    [Parameter, EditorRequired]
    public IAdvancedPositioningService AdvancedPositioningService { get; set; } = null!;
    
    [Inject] //can never be null, DI will throw exception on unresolved types
    public ISelectedViewModelsProvider? SelectedObjectsService { get; set; }

    protected abstract string Text { get; }
    
    protected abstract string ObjectName { get; }
    
    protected abstract string OnHoveredObjectShape { get; }

    protected abstract string ObjectShape { get; }
    
    protected abstract string ObjectStyleWhenSelected { get; }
    
    protected abstract string ObjectStyleWhenNotSelected { get; }
    
    private string ObjectStyle => SelectedObjectsService?.AdvancedComponent == AdvancedComponent ? ObjectStyleWhenSelected : ObjectStyleWhenNotSelected;

    protected abstract string DeleteObjectButtonShape { get; }
    
    protected abstract List<RightClickMenuEntry> GetRightClickMenuEntries();
    
    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        if (AdvancedComponent is null)
        {
            throw new ArgumentNullException(nameof(AdvancedComponent));
        }
    }
}
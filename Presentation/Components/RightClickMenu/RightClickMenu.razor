@implements IDisposable
@using Microsoft.Extensions.Localization
@using System.Diagnostics.CodeAnalysis
@using Presentation.PresentationLogic.LearningSpace
@using Presentation.PresentationLogic.LearningElement
@using Presentation.PresentationLogic.LearningPathway
@typeparam T

<g transform="translate(@_x, @_y)" cursor="@_cursor" id="rightClickMenu">
    @foreach (var (item, position) in MenuEntries.Select((item, position) => (item, position * _heightOfMenuItem)))
    {
        <g transform="translate(0, @position)">
            <Clickable OnClickedParam="LearningObject" OnClicked="(T? _) => { item.Action.Invoke(); OnClose.InvokeAsync(); }">
                <rect x="0" y="0" width="@_widthOfMenuItem" height="@_heightOfMenuItem" style="fill:rgba(233,233,233,0.5)"/>
                <text x="@(_widthOfMenuItem / 2)" y="15" text-anchor="middle" font-size="10" style="fill:rgb(23,45,76)" font-family="Roboto, Verdana">@item.DisplayedText</text>
            </Clickable>
        </g>
    }

    <g transform="translate(0, @(MenuEntries.Count * _heightOfMenuItem))">
        <Clickable OnClickedParam="LearningObject" OnClicked="(T? _) => OnClose.InvokeAsync()">
            <rect x="0" y="0" width="@_widthOfMenuItem" height="@_heightOfMenuItem" style="fill:rgba(233,233,233,0.5)"/>
            <text x="@(_widthOfMenuItem / 2)" y="15" text-anchor="middle" font-size="10" font-family="Roboto, Verdana" style="fill:rgb(23,45,76)">Close</text>
        </Clickable>
    </g>
</g>


@code {

    [Parameter, EditorRequired]
    public T? LearningObject { get; set; }

    [Parameter, EditorRequired, AllowNull] //allow null since not providing the parameter produces a warning - n.stich
    public List<RightClickMenuEntry> MenuEntries { get; set; } = new();

    [Parameter]
    public EventCallback OnClose { get; set; }

    [Inject, AllowNull] //can never be null, DI will throw exception on unresolved types - n.stich
    private ILogger<RightClickMenu<T>> Logger { get; set; }

    [Inject, AllowNull] //can never be null, DI will throw exception on unresolved types - n.stich
    private IStringLocalizer<RightClickMenu<T>> Localizer { get; set; }

    private double _x;
    private double _y;

    private string _cursor = "grab";

    private readonly int _heightOfMenuItem = 20;
    private readonly int _widthOfMenuItem = 73;

    protected override void OnParametersSet()
    {
        if (LearningObject == null)
        {
            throw new ArgumentNullException(nameof(LearningObject));
        }
        switch (LearningObject)
        {
            case ILearningSpaceViewModel ls:
                _x = ls.PositionX + 65;
                _y = ls.PositionY + 3;
                break;
            case ILearningElementViewModel le:
                _x = le.PositionX + 100;
                _y = le.PositionY;
                break;
            case PathWayConditionViewModel pc:
                _x = pc.PositionX + 77;
                _y = pc.PositionY;
                break;
            default:
                throw new ArgumentException(Localizer["RightClickMenu.OnParametersSet.ArgumentException.Message"], nameof(LearningObject));
        }
    }

    public void Dispose()
    {
    }

}